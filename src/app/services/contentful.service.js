"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var http_1 = require("@angular/common/http");
var core_1 = require("@angular/core");
var operators_1 = require("rxjs/operators");
var environment_prod_1 = require("../../environments/environment.prod");
var settings_service_1 = require("./settings.service");
var event_item_model_1 = require("../models/event-item.model");
var simple_content_model_1 = require("../models/simple-content.model");
var speaker_model_1 = require("../models/speaker.model");
var workshop_model_1 = require("../models/workshop.model");
var EventContentTypes;
(function (EventContentTypes) {
    EventContentTypes["SPEAKER"] = "speaker";
    EventContentTypes["WORKSHOP"] = "workshop";
    EventContentTypes["EVENT_ITEM"] = "eventItem";
    EventContentTypes["SIMPLE_CONTENT"] = "simpleContent";
})(EventContentTypes = exports.EventContentTypes || (exports.EventContentTypes = {}));
var EventItemType;
(function (EventItemType) {
    EventItemType["NGPOLAND"] = "ngPoland";
    EventItemType["JSPOLAND"] = "jsPoland";
})(EventItemType = exports.EventItemType || (exports.EventItemType = {}));
var EventItemCategory;
(function (EventItemCategory) {
    EventItemCategory["PRESENTATION"] = "presentation";
    EventItemCategory["BREAK"] = "break";
    EventItemCategory["EATING"] = "eating";
    EventItemCategory["QA"] = "qa";
})(EventItemCategory = exports.EventItemCategory || (exports.EventItemCategory = {}));
var ContentfulService = /** @class */ (function () {
    function ContentfulService(settings, http) {
        this.settings = settings;
        this.http = http;
        this.CONTENTFUL_URL = "https://cdn.contentful.com";
        this.CONTENTFUL_URL_ENTRIES = this.CONTENTFUL_URL + "/spaces/" + environment_prod_1.environment.contentful.spaceId + "/environments/master/entries?access_token=" + environment_prod_1.environment.contentful.token;
    }
    ContentfulService.prototype.getContentfulUrlEntry = function (entryId) {
        return "https://cdn.contentful.com/spaces/" + environment_prod_1.environment.contentful.spaceId + "/environments/master/entries/" + entryId + "?access_token=" + environment_prod_1.environment.contentful.token;
    };
    ContentfulService.prototype.getContentfulUrlParameters = function (params) {
        return Object.entries(params)
            .map(function (_a) {
            var key = _a[0], val = _a[1];
            return key + "=" + val;
        })
            .join("&");
    };
    ContentfulService.prototype.getEventItems = function (howMany, type) {
        var query = {
            content_type: EventContentTypes.EVENT_ITEM,
            locale: this.settings.getLocale(),
            "fields.type": type,
            order: "fields.startDate",
            limit: howMany
        };
        return this.http
            .get(this.CONTENTFUL_URL_ENTRIES + "&" + this.getContentfulUrlParameters(query), { responseType: "json" })
            .pipe(operators_1.map(function (entries) {
            // const assets: Array<Asset> = entries.includes.Asset;
            return entries.items.map(function (item) {
                //  const profilePhoto: Asset = this.getAssetById(assets, item.fields.photo.sys.id);
                return new event_item_model_1.EventItem(item.fields.title, item.fields.type, item.fields.category, item.fields.shortDescription, item.fields.description, item.fields.startDate, item.fields.endDate, undefined // TODO: zamienić na pobieranie Speakera
                );
            });
        }));
    };
    ContentfulService.prototype.getSimpleContentById = function (myId) {
        var query = {
            content_type: EventContentTypes.SIMPLE_CONTENT,
            locale: this.settings.getLocale(),
            "fields.myId": myId,
            limit: 1
        };
        return this.http
            .get(this.CONTENTFUL_URL_ENTRIES + "&" + this.getContentfulUrlParameters(query), { responseType: "json" })
            .pipe(operators_1.map(function (entries) {
            if (entries && entries.items && entries.items[0]) {
                return new simple_content_model_1.SimpleContent(entries.items[0].fields.myId, entries.items[0].fields.title, entries.items[0].fields.text);
            }
            else {
                return new simple_content_model_1.SimpleContent("000", "nie udało się", "nie wyszło coś");
            }
        }));
    };
    ContentfulService.prototype.getWorkshops = function (howMany) {
        var _this = this;
        var query = {
            content_type: EventContentTypes.WORKSHOP,
            locale: this.settings.getLocale(),
            order: "sys.createdAt",
            limit: howMany
        };
        return this.http
            .get(this.CONTENTFUL_URL_ENTRIES + "&" + this.getContentfulUrlParameters(query), { responseType: "json" })
            .pipe(operators_1.map(function (entries) {
            var assets = entries.includes.Asset;
            var links = entries.includes.Entry;
            return entries.items.map(function (item) {
                //  const profilePhoto: Asset = this.getAssetById(assets, item.fields.photo.sys.id);
                var speaker = _this.getEntryById(links, item.fields.instructor.sys.id);
                // console.log("Spekaer: ", speaker);
                var speakerPhoto = _this.getAssetById(assets, speaker.fields.photo.sys.id);
                return new workshop_model_1.Workshop(item.fields.title, item.fields.description, new speaker_model_1.Speaker(speaker.fields.name, speaker.fields.role, speaker.fields.bio, speakerPhoto ? speakerPhoto.fields.file.url : undefined, speakerPhoto ? speakerPhoto.fields.title : undefined, speakerPhoto ? speakerPhoto.fields.description : undefined, speaker.fields.email, speaker.fields.urlGithub, speaker.fields.urlLinkedIn, speaker.fields.urlTwitter, speaker.fields.urlWww), item.fields.startDate, item.fields.endDate, 0, // TODO: zamienić na współrzędne
                0, // TODO: zamienić na współrzędne
                item.fields.locationDescription, item.fields.pricePln);
            });
        }));
    };
    ContentfulService.prototype.getSpeakers = function (howMany) {
        var _this = this;
        var query = {
            content_type: EventContentTypes.SPEAKER,
            locale: this.settings.getLocale(),
            order: "sys.createdAt",
            limit: howMany
        };
        return this.http
            .get(this.CONTENTFUL_URL_ENTRIES + "&" + this.getContentfulUrlParameters(query), { responseType: "json" })
            .pipe(operators_1.map(function (entries) {
            var assets = entries.includes.Asset;
            return entries.items.map(function (item) {
                var profilePhoto = _this.getAssetById(assets, item.fields.photo.sys.id);
                return new speaker_model_1.Speaker(item.fields.name, item.fields.role, item.fields.bio, profilePhoto ? profilePhoto.fields.file.url : undefined, profilePhoto ? profilePhoto.fields.title : undefined, profilePhoto ? profilePhoto.fields.description : undefined, item.fields.email, item.fields.urlGithub, item.fields.urlLinkedIn, item.fields.urlTwitter, item.fields.urlWww);
            });
        }));
    };
    ContentfulService.prototype.getAssetById = function (assetArray, id) {
        if (assetArray && assetArray.length > 0) {
            var newArray = assetArray.filter(function (item) { return item.sys.id === id; });
            if (newArray && newArray.length > 0) {
                return newArray[0];
            }
        }
        return {};
    };
    ContentfulService.prototype.getAssetsByIds = function (assetArray, ids) {
        if (assetArray && assetArray.length > 0 && ids && ids.length > 0) {
            var newArray = assetArray.filter(function (item) {
                return ids.includes(item.sys.id);
            });
            return newArray;
        }
        return {};
    };
    ContentfulService.prototype.getEntryById = function (entriesArray, id) {
        if (entriesArray && entriesArray.length > 0) {
            var newArray = entriesArray.filter(function (item) { return item.sys.id === id; });
            if (newArray && newArray.length > 0) {
                return newArray[0];
            }
        }
        return {};
    };
    ContentfulService.prototype.getEntriesByContentType = function (entriesArray, contentType) {
        if (entriesArray && entriesArray.length > 0) {
            var newArray = entriesArray.filter(function (item) { return item.sys.contentType.sys.id === contentType; });
            if (newArray && newArray.length > 0) {
                return newArray;
            }
        }
        return {};
    };
    ContentfulService = __decorate([
        core_1.Injectable({
            providedIn: "root"
        }),
        __metadata("design:paramtypes", [settings_service_1.SettingsService, http_1.HttpClient])
    ], ContentfulService);
    return ContentfulService;
}());
exports.ContentfulService = ContentfulService;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udGVudGZ1bC5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY29udGVudGZ1bC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsNkNBQWtEO0FBQ2xELHNDQUEyQztBQUczQyw0Q0FBMEM7QUFDMUMsd0VBQWtFO0FBQ2xFLHVEQUFxRDtBQUVyRCwrREFBdUQ7QUFDdkQsdUVBQStEO0FBQy9ELHlEQUFrRDtBQUNsRCwyREFBb0Q7QUFFcEQsSUFBWSxpQkFLWDtBQUxELFdBQVksaUJBQWlCO0lBQzNCLHdDQUFtQixDQUFBO0lBQ25CLDBDQUFxQixDQUFBO0lBQ3JCLDZDQUF3QixDQUFBO0lBQ3hCLHFEQUFnQyxDQUFBO0FBQ2xDLENBQUMsRUFMVyxpQkFBaUIsR0FBakIseUJBQWlCLEtBQWpCLHlCQUFpQixRQUs1QjtBQUVELElBQVksYUFHWDtBQUhELFdBQVksYUFBYTtJQUN2QixzQ0FBcUIsQ0FBQTtJQUNyQixzQ0FBcUIsQ0FBQTtBQUN2QixDQUFDLEVBSFcsYUFBYSxHQUFiLHFCQUFhLEtBQWIscUJBQWEsUUFHeEI7QUFFRCxJQUFZLGlCQUtYO0FBTEQsV0FBWSxpQkFBaUI7SUFDM0Isa0RBQTZCLENBQUE7SUFDN0Isb0NBQWUsQ0FBQTtJQUNmLHNDQUFpQixDQUFBO0lBQ2pCLDhCQUFTLENBQUE7QUFDWCxDQUFDLEVBTFcsaUJBQWlCLEdBQWpCLHlCQUFpQixLQUFqQix5QkFBaUIsUUFLNUI7QUFLRDtJQU1FLDJCQUFvQixRQUF5QixFQUFVLElBQWdCO1FBQW5ELGFBQVEsR0FBUixRQUFRLENBQWlCO1FBQVUsU0FBSSxHQUFKLElBQUksQ0FBWTtRQUx0RCxtQkFBYyxHQUFHLDRCQUE0QixDQUFDO1FBQzlDLDJCQUFzQixHQUFNLElBQUksQ0FBQyxjQUFjLGdCQUM5RCw4QkFBVyxDQUFDLFVBQVUsQ0FBQyxPQUFPLGtEQUNhLDhCQUFXLENBQUMsVUFBVSxDQUFDLEtBQU8sQ0FBQztJQUVGLENBQUM7SUFF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QUM7eUNBTzhCLGtDQUFlLEVBQWdCLGlCQUFVO09BTjVELGlCQUFpQixDQXVQN0I7SUFBRCx3QkFBQztDQUFBLEFBdlBELElBdVBDO0FBdlBZLDhDQUFpQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEh0dHBDbGllbnQgfSBmcm9tIFwiQGFuZ3VsYXIvY29tbW9uL2h0dHBcIjtcclxuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XHJcbmltcG9ydCB7IEFzc2V0LCBFbnRyeSwgRW50cnlDb2xsZWN0aW9uIH0gZnJvbSBcImNvbnRlbnRmdWxcIjtcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gXCJyeGpzXCI7XHJcbmltcG9ydCB7IG1hcCwgdGFwIH0gZnJvbSBcInJ4anMvb3BlcmF0b3JzXCI7XHJcbmltcG9ydCB7IGVudmlyb25tZW50IH0gZnJvbSBcIi4uLy4uL2Vudmlyb25tZW50cy9lbnZpcm9ubWVudC5wcm9kXCI7XHJcbmltcG9ydCB7IFNldHRpbmdzU2VydmljZSB9IGZyb20gXCIuL3NldHRpbmdzLnNlcnZpY2VcIjtcclxuXHJcbmltcG9ydCB7IEV2ZW50SXRlbSB9IGZyb20gXCIuLi9tb2RlbHMvZXZlbnQtaXRlbS5tb2RlbFwiO1xyXG5pbXBvcnQgeyBTaW1wbGVDb250ZW50IH0gZnJvbSBcIi4uL21vZGVscy9zaW1wbGUtY29udGVudC5tb2RlbFwiO1xyXG5pbXBvcnQgeyBTcGVha2VyIH0gZnJvbSBcIi4uL21vZGVscy9zcGVha2VyLm1vZGVsXCI7XHJcbmltcG9ydCB7IFdvcmtzaG9wIH0gZnJvbSBcIi4uL21vZGVscy93b3Jrc2hvcC5tb2RlbFwiO1xyXG5cclxuZXhwb3J0IGVudW0gRXZlbnRDb250ZW50VHlwZXMge1xyXG4gIFNQRUFLRVIgPSBcInNwZWFrZXJcIixcclxuICBXT1JLU0hPUCA9IFwid29ya3Nob3BcIixcclxuICBFVkVOVF9JVEVNID0gXCJldmVudEl0ZW1cIixcclxuICBTSU1QTEVfQ09OVEVOVCA9IFwic2ltcGxlQ29udGVudFwiXHJcbn1cclxuXHJcbmV4cG9ydCBlbnVtIEV2ZW50SXRlbVR5cGUge1xyXG4gIE5HUE9MQU5EID0gXCJuZ1BvbGFuZFwiLFxyXG4gIEpTUE9MQU5EID0gXCJqc1BvbGFuZFwiXHJcbn1cclxuXHJcbmV4cG9ydCBlbnVtIEV2ZW50SXRlbUNhdGVnb3J5IHtcclxuICBQUkVTRU5UQVRJT04gPSBcInByZXNlbnRhdGlvblwiLFxyXG4gIEJSRUFLID0gXCJicmVha1wiLFxyXG4gIEVBVElORyA9IFwiZWF0aW5nXCIsXHJcbiAgUUEgPSBcInFhXCJcclxufVxyXG5cclxuQEluamVjdGFibGUoe1xyXG4gIHByb3ZpZGVkSW46IFwicm9vdFwiXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBDb250ZW50ZnVsU2VydmljZSB7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBDT05URU5URlVMX1VSTCA9IFwiaHR0cHM6Ly9jZG4uY29udGVudGZ1bC5jb21cIjtcclxuICBwcml2YXRlIHJlYWRvbmx5IENPTlRFTlRGVUxfVVJMX0VOVFJJRVMgPSBgJHt0aGlzLkNPTlRFTlRGVUxfVVJMfS9zcGFjZXMvJHtcclxuICAgIGVudmlyb25tZW50LmNvbnRlbnRmdWwuc3BhY2VJZFxyXG4gIH0vZW52aXJvbm1lbnRzL21hc3Rlci9lbnRyaWVzP2FjY2Vzc190b2tlbj0ke2Vudmlyb25tZW50LmNvbnRlbnRmdWwudG9rZW59YDtcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBzZXR0aW5nczogU2V0dGluZ3NTZXJ2aWNlLCBwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQpIHt9XHJcblxyXG4gIGdldENvbnRlbnRmdWxVcmxFbnRyeShlbnRyeUlkOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIGBodHRwczovL2Nkbi5jb250ZW50ZnVsLmNvbS9zcGFjZXMvJHtcclxuICAgICAgZW52aXJvbm1lbnQuY29udGVudGZ1bC5zcGFjZUlkXHJcbiAgICB9L2Vudmlyb25tZW50cy9tYXN0ZXIvZW50cmllcy8ke2VudHJ5SWR9P2FjY2Vzc190b2tlbj0ke1xyXG4gICAgICBlbnZpcm9ubWVudC5jb250ZW50ZnVsLnRva2VuXHJcbiAgICB9YDtcclxuICB9XHJcblxyXG4gIGdldENvbnRlbnRmdWxVcmxQYXJhbWV0ZXJzKHBhcmFtczoge30pOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIE9iamVjdC5lbnRyaWVzKHBhcmFtcylcclxuICAgICAgLm1hcCgoW2tleSwgdmFsXSkgPT4gYCR7a2V5fT0ke3ZhbH1gKVxyXG4gICAgICAuam9pbihcIiZcIik7XHJcbiAgfVxyXG5cclxuICBnZXRFdmVudEl0ZW1zKFxyXG4gICAgaG93TWFueTogbnVtYmVyLFxyXG4gICAgdHlwZTogRXZlbnRJdGVtVHlwZVxyXG4gICk6IE9ic2VydmFibGU8QXJyYXk8RXZlbnRJdGVtPj4ge1xyXG4gICAgY29uc3QgcXVlcnkgPSB7XHJcbiAgICAgIGNvbnRlbnRfdHlwZTogRXZlbnRDb250ZW50VHlwZXMuRVZFTlRfSVRFTSxcclxuICAgICAgbG9jYWxlOiB0aGlzLnNldHRpbmdzLmdldExvY2FsZSgpLFxyXG4gICAgICBcImZpZWxkcy50eXBlXCI6IHR5cGUsXHJcbiAgICAgIG9yZGVyOiBcImZpZWxkcy5zdGFydERhdGVcIixcclxuICAgICAgbGltaXQ6IGhvd01hbnlcclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuaHR0cFxyXG4gICAgICAuZ2V0KFxyXG4gICAgICAgIGAke3RoaXMuQ09OVEVOVEZVTF9VUkxfRU5UUklFU30mJHt0aGlzLmdldENvbnRlbnRmdWxVcmxQYXJhbWV0ZXJzKFxyXG4gICAgICAgICAgcXVlcnlcclxuICAgICAgICApfWAsXHJcbiAgICAgICAgeyByZXNwb25zZVR5cGU6IFwianNvblwiIH1cclxuICAgICAgKVxyXG4gICAgICAucGlwZShcclxuICAgICAgICBtYXAoKGVudHJpZXM6IEVudHJ5Q29sbGVjdGlvbjxhbnk+KSA9PiB7XHJcbiAgICAgICAgICAvLyBjb25zdCBhc3NldHM6IEFycmF5PEFzc2V0PiA9IGVudHJpZXMuaW5jbHVkZXMuQXNzZXQ7XHJcblxyXG4gICAgICAgICAgcmV0dXJuIGVudHJpZXMuaXRlbXMubWFwKChpdGVtOiBFbnRyeTxhbnk+KSA9PiB7XHJcbiAgICAgICAgICAgIC8vICBjb25zdCBwcm9maWxlUGhvdG86IEFzc2V0ID0gdGhpcy5nZXRBc3NldEJ5SWQoYXNzZXRzLCBpdGVtLmZpZWxkcy5waG90by5zeXMuaWQpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBFdmVudEl0ZW0oXHJcbiAgICAgICAgICAgICAgaXRlbS5maWVsZHMudGl0bGUsXHJcbiAgICAgICAgICAgICAgaXRlbS5maWVsZHMudHlwZSxcclxuICAgICAgICAgICAgICBpdGVtLmZpZWxkcy5jYXRlZ29yeSxcclxuICAgICAgICAgICAgICBpdGVtLmZpZWxkcy5zaG9ydERlc2NyaXB0aW9uLFxyXG4gICAgICAgICAgICAgIGl0ZW0uZmllbGRzLmRlc2NyaXB0aW9uLFxyXG4gICAgICAgICAgICAgIGl0ZW0uZmllbGRzLnN0YXJ0RGF0ZSxcclxuICAgICAgICAgICAgICBpdGVtLmZpZWxkcy5lbmREYXRlLFxyXG4gICAgICAgICAgICAgIHVuZGVmaW5lZCAvLyBUT0RPOiB6YW1pZW5pxIcgbmEgcG9iaWVyYW5pZSBTcGVha2VyYVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSlcclxuICAgICAgKTtcclxuICB9XHJcblxyXG4gIGdldFNpbXBsZUNvbnRlbnRCeUlkKG15SWQ6IHN0cmluZyk6IE9ic2VydmFibGU8U2ltcGxlQ29udGVudD4ge1xyXG4gICAgY29uc3QgcXVlcnkgPSB7XHJcbiAgICAgIGNvbnRlbnRfdHlwZTogRXZlbnRDb250ZW50VHlwZXMuU0lNUExFX0NPTlRFTlQsXHJcbiAgICAgIGxvY2FsZTogdGhpcy5zZXR0aW5ncy5nZXRMb2NhbGUoKSxcclxuICAgICAgXCJmaWVsZHMubXlJZFwiOiBteUlkLFxyXG4gICAgICBsaW1pdDogMVxyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4gdGhpcy5odHRwXHJcbiAgICAgIC5nZXQoXHJcbiAgICAgICAgYCR7dGhpcy5DT05URU5URlVMX1VSTF9FTlRSSUVTfSYke3RoaXMuZ2V0Q29udGVudGZ1bFVybFBhcmFtZXRlcnMoXHJcbiAgICAgICAgICBxdWVyeVxyXG4gICAgICAgICl9YCxcclxuICAgICAgICB7IHJlc3BvbnNlVHlwZTogXCJqc29uXCIgfVxyXG4gICAgICApXHJcbiAgICAgIC5waXBlKFxyXG4gICAgICAgIG1hcCgoZW50cmllczogRW50cnlDb2xsZWN0aW9uPFNpbXBsZUNvbnRlbnQ+KSA9PiB7XHJcbiAgICAgICAgICBpZiAoZW50cmllcyAmJiBlbnRyaWVzLml0ZW1zICYmIGVudHJpZXMuaXRlbXNbMF0pIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBTaW1wbGVDb250ZW50KFxyXG4gICAgICAgICAgICAgIGVudHJpZXMuaXRlbXNbMF0uZmllbGRzLm15SWQsXHJcbiAgICAgICAgICAgICAgZW50cmllcy5pdGVtc1swXS5maWVsZHMudGl0bGUsXHJcbiAgICAgICAgICAgICAgZW50cmllcy5pdGVtc1swXS5maWVsZHMudGV4dFxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBTaW1wbGVDb250ZW50KFwiMDAwXCIsIFwibmllIHVkYcWCbyBzacSZXCIsIFwibmllIHd5c3rFgm8gY2/Fm1wiKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICApO1xyXG4gIH1cclxuXHJcbiAgZ2V0V29ya3Nob3BzKGhvd01hbnk6IG51bWJlcik6IE9ic2VydmFibGU8QXJyYXk8V29ya3Nob3A+PiB7XHJcbiAgICBjb25zdCBxdWVyeSA9IHtcclxuICAgICAgY29udGVudF90eXBlOiBFdmVudENvbnRlbnRUeXBlcy5XT1JLU0hPUCxcclxuICAgICAgbG9jYWxlOiB0aGlzLnNldHRpbmdzLmdldExvY2FsZSgpLFxyXG4gICAgICBvcmRlcjogXCJzeXMuY3JlYXRlZEF0XCIsXHJcbiAgICAgIGxpbWl0OiBob3dNYW55XHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiB0aGlzLmh0dHBcclxuICAgICAgLmdldChcclxuICAgICAgICBgJHt0aGlzLkNPTlRFTlRGVUxfVVJMX0VOVFJJRVN9JiR7dGhpcy5nZXRDb250ZW50ZnVsVXJsUGFyYW1ldGVycyhcclxuICAgICAgICAgIHF1ZXJ5XHJcbiAgICAgICAgKX1gLFxyXG4gICAgICAgIHsgcmVzcG9uc2VUeXBlOiBcImpzb25cIiB9XHJcbiAgICAgIClcclxuICAgICAgLnBpcGUoXHJcbiAgICAgICAgbWFwKChlbnRyaWVzOiBFbnRyeUNvbGxlY3Rpb248YW55PikgPT4ge1xyXG4gICAgICAgICAgY29uc3QgYXNzZXRzOiBBcnJheTxBc3NldD4gPSBlbnRyaWVzLmluY2x1ZGVzLkFzc2V0O1xyXG4gICAgICAgICAgY29uc3QgbGlua3M6IEFycmF5PEVudHJ5PGFueT4+ID0gZW50cmllcy5pbmNsdWRlcy5FbnRyeTtcclxuXHJcbiAgICAgICAgICByZXR1cm4gZW50cmllcy5pdGVtcy5tYXAoKGl0ZW06IEVudHJ5PGFueT4pID0+IHtcclxuICAgICAgICAgICAgLy8gIGNvbnN0IHByb2ZpbGVQaG90bzogQXNzZXQgPSB0aGlzLmdldEFzc2V0QnlJZChhc3NldHMsIGl0ZW0uZmllbGRzLnBob3RvLnN5cy5pZCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHNwZWFrZXIgPSB0aGlzLmdldEVudHJ5QnlJZChcclxuICAgICAgICAgICAgICBsaW5rcyxcclxuICAgICAgICAgICAgICBpdGVtLmZpZWxkcy5pbnN0cnVjdG9yLnN5cy5pZFxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcIlNwZWthZXI6IFwiLCBzcGVha2VyKTtcclxuICAgICAgICAgICAgY29uc3Qgc3BlYWtlclBob3RvID0gdGhpcy5nZXRBc3NldEJ5SWQoXHJcbiAgICAgICAgICAgICAgYXNzZXRzLFxyXG4gICAgICAgICAgICAgIHNwZWFrZXIuZmllbGRzLnBob3RvLnN5cy5pZFxyXG4gICAgICAgICAgICApO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBXb3Jrc2hvcChcclxuICAgICAgICAgICAgICBpdGVtLmZpZWxkcy50aXRsZSxcclxuICAgICAgICAgICAgICBpdGVtLmZpZWxkcy5kZXNjcmlwdGlvbixcclxuICAgICAgICAgICAgICBuZXcgU3BlYWtlcihcclxuICAgICAgICAgICAgICAgIHNwZWFrZXIuZmllbGRzLm5hbWUsXHJcbiAgICAgICAgICAgICAgICBzcGVha2VyLmZpZWxkcy5yb2xlLFxyXG4gICAgICAgICAgICAgICAgc3BlYWtlci5maWVsZHMuYmlvLFxyXG4gICAgICAgICAgICAgICAgc3BlYWtlclBob3RvID8gc3BlYWtlclBob3RvLmZpZWxkcy5maWxlLnVybCA6IHVuZGVmaW5lZCxcclxuICAgICAgICAgICAgICAgIHNwZWFrZXJQaG90byA/IHNwZWFrZXJQaG90by5maWVsZHMudGl0bGUgOiB1bmRlZmluZWQsXHJcbiAgICAgICAgICAgICAgICBzcGVha2VyUGhvdG8gPyBzcGVha2VyUGhvdG8uZmllbGRzLmRlc2NyaXB0aW9uIDogdW5kZWZpbmVkLFxyXG4gICAgICAgICAgICAgICAgc3BlYWtlci5maWVsZHMuZW1haWwsXHJcbiAgICAgICAgICAgICAgICBzcGVha2VyLmZpZWxkcy51cmxHaXRodWIsXHJcbiAgICAgICAgICAgICAgICBzcGVha2VyLmZpZWxkcy51cmxMaW5rZWRJbixcclxuICAgICAgICAgICAgICAgIHNwZWFrZXIuZmllbGRzLnVybFR3aXR0ZXIsXHJcbiAgICAgICAgICAgICAgICBzcGVha2VyLmZpZWxkcy51cmxXd3dcclxuICAgICAgICAgICAgICApLFxyXG4gICAgICAgICAgICAgIGl0ZW0uZmllbGRzLnN0YXJ0RGF0ZSxcclxuICAgICAgICAgICAgICBpdGVtLmZpZWxkcy5lbmREYXRlLFxyXG4gICAgICAgICAgICAgIDAsIC8vIFRPRE86IHphbWllbmnEhyBuYSB3c3DDs8WCcnrEmWRuZVxyXG4gICAgICAgICAgICAgIDAsIC8vIFRPRE86IHphbWllbmnEhyBuYSB3c3DDs8WCcnrEmWRuZVxyXG4gICAgICAgICAgICAgIGl0ZW0uZmllbGRzLmxvY2F0aW9uRGVzY3JpcHRpb24sXHJcbiAgICAgICAgICAgICAgaXRlbS5maWVsZHMucHJpY2VQbG5cclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICk7XHJcbiAgfVxyXG5cclxuICBnZXRTcGVha2Vycyhob3dNYW55OiBudW1iZXIpOiBPYnNlcnZhYmxlPEFycmF5PFNwZWFrZXI+PiB7XHJcbiAgICBjb25zdCBxdWVyeSA9IHtcclxuICAgICAgY29udGVudF90eXBlOiBFdmVudENvbnRlbnRUeXBlcy5TUEVBS0VSLFxyXG4gICAgICBsb2NhbGU6IHRoaXMuc2V0dGluZ3MuZ2V0TG9jYWxlKCksXHJcbiAgICAgIG9yZGVyOiBcInN5cy5jcmVhdGVkQXRcIixcclxuICAgICAgbGltaXQ6IGhvd01hbnlcclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuaHR0cFxyXG4gICAgICAuZ2V0KFxyXG4gICAgICAgIGAke3RoaXMuQ09OVEVOVEZVTF9VUkxfRU5UUklFU30mJHt0aGlzLmdldENvbnRlbnRmdWxVcmxQYXJhbWV0ZXJzKFxyXG4gICAgICAgICAgcXVlcnlcclxuICAgICAgICApfWAsXHJcbiAgICAgICAgeyByZXNwb25zZVR5cGU6IFwianNvblwiIH1cclxuICAgICAgKVxyXG4gICAgICAucGlwZShcclxuICAgICAgICBtYXAoKGVudHJpZXM6IEVudHJ5Q29sbGVjdGlvbjxhbnk+KSA9PiB7XHJcbiAgICAgICAgICBjb25zdCBhc3NldHM6IEFycmF5PEFzc2V0PiA9IGVudHJpZXMuaW5jbHVkZXMuQXNzZXQ7XHJcblxyXG4gICAgICAgICAgcmV0dXJuIGVudHJpZXMuaXRlbXMubWFwKChpdGVtOiBFbnRyeTxhbnk+KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHByb2ZpbGVQaG90bzogQXNzZXQgPSB0aGlzLmdldEFzc2V0QnlJZChcclxuICAgICAgICAgICAgICBhc3NldHMsXHJcbiAgICAgICAgICAgICAgaXRlbS5maWVsZHMucGhvdG8uc3lzLmlkXHJcbiAgICAgICAgICAgICk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFNwZWFrZXIoXHJcbiAgICAgICAgICAgICAgaXRlbS5maWVsZHMubmFtZSxcclxuICAgICAgICAgICAgICBpdGVtLmZpZWxkcy5yb2xlLFxyXG4gICAgICAgICAgICAgIGl0ZW0uZmllbGRzLmJpbyxcclxuICAgICAgICAgICAgICBwcm9maWxlUGhvdG8gPyBwcm9maWxlUGhvdG8uZmllbGRzLmZpbGUudXJsIDogdW5kZWZpbmVkLFxyXG4gICAgICAgICAgICAgIHByb2ZpbGVQaG90byA/IHByb2ZpbGVQaG90by5maWVsZHMudGl0bGUgOiB1bmRlZmluZWQsXHJcbiAgICAgICAgICAgICAgcHJvZmlsZVBob3RvID8gcHJvZmlsZVBob3RvLmZpZWxkcy5kZXNjcmlwdGlvbiA6IHVuZGVmaW5lZCxcclxuICAgICAgICAgICAgICBpdGVtLmZpZWxkcy5lbWFpbCxcclxuICAgICAgICAgICAgICBpdGVtLmZpZWxkcy51cmxHaXRodWIsXHJcbiAgICAgICAgICAgICAgaXRlbS5maWVsZHMudXJsTGlua2VkSW4sXHJcbiAgICAgICAgICAgICAgaXRlbS5maWVsZHMudXJsVHdpdHRlcixcclxuICAgICAgICAgICAgICBpdGVtLmZpZWxkcy51cmxXd3dcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldEFzc2V0QnlJZChhc3NldEFycmF5OiBBcnJheTxBc3NldD4sIGlkOiBzdHJpbmcpOiBhbnkge1xyXG4gICAgaWYgKGFzc2V0QXJyYXkgJiYgYXNzZXRBcnJheS5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGNvbnN0IG5ld0FycmF5ID0gYXNzZXRBcnJheS5maWx0ZXIoKGl0ZW06IEFzc2V0KSA9PiBpdGVtLnN5cy5pZCA9PT0gaWQpO1xyXG4gICAgICBpZiAobmV3QXJyYXkgJiYgbmV3QXJyYXkubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIHJldHVybiBuZXdBcnJheVswXTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7fTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0QXNzZXRzQnlJZHMoYXNzZXRBcnJheTogQXJyYXk8QXNzZXQ+LCBpZHM6IEFycmF5PHN0cmluZz4pOiBhbnkge1xyXG4gICAgaWYgKGFzc2V0QXJyYXkgJiYgYXNzZXRBcnJheS5sZW5ndGggPiAwICYmIGlkcyAmJiBpZHMubGVuZ3RoID4gMCkge1xyXG4gICAgICBjb25zdCBuZXdBcnJheSA9IGFzc2V0QXJyYXkuZmlsdGVyKChpdGVtOiBBc3NldCkgPT4ge1xyXG4gICAgICAgIHJldHVybiBpZHMuaW5jbHVkZXMoaXRlbS5zeXMuaWQpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHJldHVybiBuZXdBcnJheTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge307XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldEVudHJ5QnlJZChlbnRyaWVzQXJyYXk6IEFycmF5PEVudHJ5PGFueT4+LCBpZDogc3RyaW5nKTogYW55IHtcclxuICAgIGlmIChlbnRyaWVzQXJyYXkgJiYgZW50cmllc0FycmF5Lmxlbmd0aCA+IDApIHtcclxuICAgICAgY29uc3QgbmV3QXJyYXkgPSBlbnRyaWVzQXJyYXkuZmlsdGVyKFxyXG4gICAgICAgIChpdGVtOiBFbnRyeTxhbnk+KSA9PiBpdGVtLnN5cy5pZCA9PT0gaWRcclxuICAgICAgKTtcclxuICAgICAgaWYgKG5ld0FycmF5ICYmIG5ld0FycmF5Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICByZXR1cm4gbmV3QXJyYXlbMF07XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge307XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldEVudHJpZXNCeUNvbnRlbnRUeXBlKFxyXG4gICAgZW50cmllc0FycmF5OiBBcnJheTxFbnRyeTxhbnk+PixcclxuICAgIGNvbnRlbnRUeXBlOiBFdmVudENvbnRlbnRUeXBlc1xyXG4gICk6IGFueSB7XHJcbiAgICBpZiAoZW50cmllc0FycmF5ICYmIGVudHJpZXNBcnJheS5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGNvbnN0IG5ld0FycmF5ID0gZW50cmllc0FycmF5LmZpbHRlcihcclxuICAgICAgICAoaXRlbTogRW50cnk8YW55PikgPT4gaXRlbS5zeXMuY29udGVudFR5cGUuc3lzLmlkID09PSBjb250ZW50VHlwZVxyXG4gICAgICApO1xyXG4gICAgICBpZiAobmV3QXJyYXkgJiYgbmV3QXJyYXkubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIHJldHVybiBuZXdBcnJheTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7fTtcclxuICB9XHJcbn1cclxuIl19