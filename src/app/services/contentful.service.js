"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var http_1 = require("@angular/common/http");
var core_1 = require("@angular/core");
var operators_1 = require("rxjs/operators");
var environment_prod_1 = require("../../environments/environment.prod");
var settings_service_1 = require("./settings.service");
var event_item_model_1 = require("../models/event-item.model");
var speaker_model_1 = require("../models/speaker.model");
var workshop_model_1 = require("../models/workshop.model");
var EventContentTypes;
(function (EventContentTypes) {
    EventContentTypes["SPEAKER"] = "speaker";
    EventContentTypes["WORKSHOP"] = "workshop";
    EventContentTypes["EVENT_ITEM"] = "eventItem";
})(EventContentTypes = exports.EventContentTypes || (exports.EventContentTypes = {}));
var EventItemType;
(function (EventItemType) {
    EventItemType["NGPOLAND"] = "ngPoland";
    EventItemType["JSPOLAND"] = "jsPoland";
})(EventItemType = exports.EventItemType || (exports.EventItemType = {}));
var EventItemCategory;
(function (EventItemCategory) {
    EventItemCategory["PRESENTATION"] = "presentation";
    EventItemCategory["BREAK"] = "break";
    EventItemCategory["EATING"] = "eating";
    EventItemCategory["QA"] = "qa";
})(EventItemCategory = exports.EventItemCategory || (exports.EventItemCategory = {}));
var ContentfulService = /** @class */ (function () {
    function ContentfulService(settings, http) {
        this.settings = settings;
        this.http = http;
        this.CONTENTFUL_URL = "https://cdn.contentful.com";
        this.CONTENTFUL_URL_ENTRIES = this.CONTENTFUL_URL + "/spaces/" + environment_prod_1.environment.contentful.spaceId + "/environments/master/entries?access_token=" + environment_prod_1.environment.contentful.token;
    }
    ContentfulService.prototype.getContentfulUrlEntry = function (entryId) {
        return "https://cdn.contentful.com/spaces/" + environment_prod_1.environment.contentful.spaceId + "/environments/master/entries/" + entryId + "?access_token=" + environment_prod_1.environment.contentful.token;
    };
    ContentfulService.prototype.getContentfulUrlParameters = function (params) {
        return Object.entries(params)
            .map(function (_a) {
            var key = _a[0], val = _a[1];
            return key + "=" + val;
        })
            .join("&");
    };
    ContentfulService.prototype.getEventItems = function (howMany, type) {
        var query = {
            content_type: EventContentTypes.EVENT_ITEM,
            locale: this.settings.getLocale(),
            "fields.type": type,
            order: "fields.startDate",
            limit: howMany
        };
        return this.http
            .get(this.CONTENTFUL_URL_ENTRIES + "&" + this.getContentfulUrlParameters(query), { responseType: "json" })
            .pipe(operators_1.map(function (entries) {
            // const assets: Array<Asset> = entries.includes.Asset;
            return entries.items.map(function (item) {
                //  const profilePhoto: Asset = this.getAssetById(assets, item.fields.photo.sys.id);
                return new event_item_model_1.EventItem(item.fields.title, item.fields.type, item.fields.category, item.fields.shortDescription, item.fields.description, item.fields.startDate, item.fields.endDate, undefined // TODO: zamienić na pobieranie Speakera
                );
            });
        }));
    };
    ContentfulService.prototype.getWorkshops = function (howMany) {
        var _this = this;
        var query = {
            content_type: EventContentTypes.WORKSHOP,
            locale: this.settings.getLocale(),
            order: "sys.createdAt",
            limit: howMany
        };
        return this.http
            .get(this.CONTENTFUL_URL_ENTRIES + "&" + this.getContentfulUrlParameters(query), { responseType: "json" })
            .pipe(operators_1.map(function (entries) {
            var assets = entries.includes.Asset;
            var links = entries.includes.Entry;
            return entries.items.map(function (item) {
                //  const profilePhoto: Asset = this.getAssetById(assets, item.fields.photo.sys.id);
                var speaker = _this.getEntryById(links, item.fields.instructor.sys.id);
                // console.log("Spekaer: ", speaker);
                var speakerPhoto = _this.getAssetById(assets, speaker.fields.photo.sys.id);
                return new workshop_model_1.Workshop(item.fields.title, item.fields.description, new speaker_model_1.Speaker(speaker.fields.name, speaker.fields.role, speaker.fields.bio, speakerPhoto ? speakerPhoto.fields.file.url : undefined, speakerPhoto ? speakerPhoto.fields.title : undefined, speakerPhoto ? speakerPhoto.fields.description : undefined, speaker.fields.email, speaker.fields.urlGithub, speaker.fields.urlLinkedIn, speaker.fields.urlTwitter, speaker.fields.urlWww), item.fields.startDate, item.fields.endDate, 0, // TODO: zamienić na współrzędne
                0, // TODO: zamienić na współrzędne
                item.fields.locationDescription, item.fields.pricePln);
            });
        }));
    };
    ContentfulService.prototype.getSpeakers = function (howMany) {
        var _this = this;
        var query = {
            content_type: EventContentTypes.SPEAKER,
            locale: this.settings.getLocale(),
            order: "sys.createdAt",
            limit: howMany
        };
        return this.http
            .get(this.CONTENTFUL_URL_ENTRIES + "&" + this.getContentfulUrlParameters(query), { responseType: "json" })
            .pipe(operators_1.map(function (entries) {
            var assets = entries.includes.Asset;
            return entries.items.map(function (item) {
                var profilePhoto = _this.getAssetById(assets, item.fields.photo.sys.id);
                return new speaker_model_1.Speaker(item.fields.name, item.fields.role, item.fields.bio, profilePhoto ? profilePhoto.fields.file.url : undefined, profilePhoto ? profilePhoto.fields.title : undefined, profilePhoto ? profilePhoto.fields.description : undefined, item.fields.email, item.fields.urlGithub, item.fields.urlLinkedIn, item.fields.urlTwitter, item.fields.urlWww);
            });
        }));
    };
    ContentfulService.prototype.getAssetById = function (assetArray, id) {
        if (assetArray && assetArray.length > 0) {
            var newArray = assetArray.filter(function (item) { return item.sys.id === id; });
            if (newArray && newArray.length > 0) {
                return newArray[0];
            }
        }
        return {};
    };
    ContentfulService.prototype.getAssetsByIds = function (assetArray, ids) {
        if (assetArray && assetArray.length > 0 && ids && ids.length > 0) {
            var newArray = assetArray.filter(function (item) {
                return ids.includes(item.sys.id);
            });
            return newArray;
        }
        return {};
    };
    ContentfulService.prototype.getEntryById = function (entriesArray, id) {
        if (entriesArray && entriesArray.length > 0) {
            var newArray = entriesArray.filter(function (item) { return item.sys.id === id; });
            if (newArray && newArray.length > 0) {
                return newArray[0];
            }
        }
        return {};
    };
    ContentfulService.prototype.getEntriesByContentType = function (entriesArray, contentType) {
        if (entriesArray && entriesArray.length > 0) {
            var newArray = entriesArray.filter(function (item) { return item.sys.contentType.sys.id === contentType; });
            if (newArray && newArray.length > 0) {
                return newArray;
            }
        }
        return {};
    };
    ContentfulService = __decorate([
        core_1.Injectable({
            providedIn: "root"
        }),
        __metadata("design:paramtypes", [settings_service_1.SettingsService, http_1.HttpClient])
    ], ContentfulService);
    return ContentfulService;
}());
exports.ContentfulService = ContentfulService;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udGVudGZ1bC5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY29udGVudGZ1bC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsNkNBQWtEO0FBQ2xELHNDQUEyQztBQUczQyw0Q0FBcUM7QUFDckMsd0VBQWtFO0FBQ2xFLHVEQUFxRDtBQUVyRCwrREFBdUQ7QUFDdkQseURBQWtEO0FBQ2xELDJEQUFvRDtBQUVwRCxJQUFZLGlCQUlYO0FBSkQsV0FBWSxpQkFBaUI7SUFDM0Isd0NBQW1CLENBQUE7SUFDbkIsMENBQXFCLENBQUE7SUFDckIsNkNBQXdCLENBQUE7QUFDMUIsQ0FBQyxFQUpXLGlCQUFpQixHQUFqQix5QkFBaUIsS0FBakIseUJBQWlCLFFBSTVCO0FBRUQsSUFBWSxhQUdYO0FBSEQsV0FBWSxhQUFhO0lBQ3ZCLHNDQUFxQixDQUFBO0lBQ3JCLHNDQUFxQixDQUFBO0FBQ3ZCLENBQUMsRUFIVyxhQUFhLEdBQWIscUJBQWEsS0FBYixxQkFBYSxRQUd4QjtBQUVELElBQVksaUJBS1g7QUFMRCxXQUFZLGlCQUFpQjtJQUMzQixrREFBNkIsQ0FBQTtJQUM3QixvQ0FBZSxDQUFBO0lBQ2Ysc0NBQWlCLENBQUE7SUFDakIsOEJBQVMsQ0FBQTtBQUNYLENBQUMsRUFMVyxpQkFBaUIsR0FBakIseUJBQWlCLEtBQWpCLHlCQUFpQixRQUs1QjtBQUtEO0lBTUUsMkJBQW9CLFFBQXlCLEVBQVUsSUFBZ0I7UUFBbkQsYUFBUSxHQUFSLFFBQVEsQ0FBaUI7UUFBVSxTQUFJLEdBQUosSUFBSSxDQUFZO1FBTHRELG1CQUFjLEdBQUcsNEJBQTRCLENBQUM7UUFDOUMsMkJBQXNCLEdBQU0sSUFBSSxDQUFDLGNBQWMsZ0JBQzlELDhCQUFXLENBQUMsVUFBVSxDQUFDLE9BQU8sa0RBQ2EsOEJBQVcsQ0FBQyxVQUFVLENBQUMsS0FBTyxDQUFDO0lBRUYsQ0FBQztJQUUzRSxpREFBcUIsR0FBckIsVUFBc0IsT0FBZTtRQUNu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O0lBQ1osQ0FBQztJQXhOVSxpQkFBaUI7UUFIN0IsaUJBQVUsQ0FBQztZQUNWLFVBQVUsRUFBRSxNQUFNO1NBQ25CLENBQUM7eUNBTzhCLGtDQUFlLEVBQWdCLGlCQUFVO09BTjVELGlCQUFpQixDQXlON0I7SUFBRCx3QkFBQztDQUFBLEFBek5ELElBeU5DO0FBek5ZLDhDQUFpQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEh0dHBDbGllbnQgfSBmcm9tIFwiQGFuZ3VsYXIvY29tbW9uL2h0dHBcIjtcclxuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XHJcbmltcG9ydCB7IEFzc2V0LCBFbnRyeSwgRW50cnlDb2xsZWN0aW9uIH0gZnJvbSBcImNvbnRlbnRmdWxcIjtcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gXCJyeGpzXCI7XHJcbmltcG9ydCB7IG1hcCB9IGZyb20gXCJyeGpzL29wZXJhdG9yc1wiO1xyXG5pbXBvcnQgeyBlbnZpcm9ubWVudCB9IGZyb20gXCIuLi8uLi9lbnZpcm9ubWVudHMvZW52aXJvbm1lbnQucHJvZFwiO1xyXG5pbXBvcnQgeyBTZXR0aW5nc1NlcnZpY2UgfSBmcm9tIFwiLi9zZXR0aW5ncy5zZXJ2aWNlXCI7XHJcblxyXG5pbXBvcnQgeyBFdmVudEl0ZW0gfSBmcm9tIFwiLi4vbW9kZWxzL2V2ZW50LWl0ZW0ubW9kZWxcIjtcclxuaW1wb3J0IHsgU3BlYWtlciB9IGZyb20gXCIuLi9tb2RlbHMvc3BlYWtlci5tb2RlbFwiO1xyXG5pbXBvcnQgeyBXb3Jrc2hvcCB9IGZyb20gXCIuLi9tb2RlbHMvd29ya3Nob3AubW9kZWxcIjtcclxuXHJcbmV4cG9ydCBlbnVtIEV2ZW50Q29udGVudFR5cGVzIHtcclxuICBTUEVBS0VSID0gXCJzcGVha2VyXCIsXHJcbiAgV09SS1NIT1AgPSBcIndvcmtzaG9wXCIsXHJcbiAgRVZFTlRfSVRFTSA9IFwiZXZlbnRJdGVtXCJcclxufVxyXG5cclxuZXhwb3J0IGVudW0gRXZlbnRJdGVtVHlwZSB7XHJcbiAgTkdQT0xBTkQgPSBcIm5nUG9sYW5kXCIsXHJcbiAgSlNQT0xBTkQgPSBcImpzUG9sYW5kXCJcclxufVxyXG5cclxuZXhwb3J0IGVudW0gRXZlbnRJdGVtQ2F0ZWdvcnkge1xyXG4gIFBSRVNFTlRBVElPTiA9IFwicHJlc2VudGF0aW9uXCIsXHJcbiAgQlJFQUsgPSBcImJyZWFrXCIsXHJcbiAgRUFUSU5HID0gXCJlYXRpbmdcIixcclxuICBRQSA9IFwicWFcIlxyXG59XHJcblxyXG5ASW5qZWN0YWJsZSh7XHJcbiAgcHJvdmlkZWRJbjogXCJyb290XCJcclxufSlcclxuZXhwb3J0IGNsYXNzIENvbnRlbnRmdWxTZXJ2aWNlIHtcclxuICBwcml2YXRlIHJlYWRvbmx5IENPTlRFTlRGVUxfVVJMID0gXCJodHRwczovL2Nkbi5jb250ZW50ZnVsLmNvbVwiO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgQ09OVEVOVEZVTF9VUkxfRU5UUklFUyA9IGAke3RoaXMuQ09OVEVOVEZVTF9VUkx9L3NwYWNlcy8ke1xyXG4gICAgZW52aXJvbm1lbnQuY29udGVudGZ1bC5zcGFjZUlkXHJcbiAgfS9lbnZpcm9ubWVudHMvbWFzdGVyL2VudHJpZXM/YWNjZXNzX3Rva2VuPSR7ZW52aXJvbm1lbnQuY29udGVudGZ1bC50b2tlbn1gO1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHNldHRpbmdzOiBTZXR0aW5nc1NlcnZpY2UsIHByaXZhdGUgaHR0cDogSHR0cENsaWVudCkge31cclxuXHJcbiAgZ2V0Q29udGVudGZ1bFVybEVudHJ5KGVudHJ5SWQ6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICByZXR1cm4gYGh0dHBzOi8vY2RuLmNvbnRlbnRmdWwuY29tL3NwYWNlcy8ke1xyXG4gICAgICBlbnZpcm9ubWVudC5jb250ZW50ZnVsLnNwYWNlSWRcclxuICAgIH0vZW52aXJvbm1lbnRzL21hc3Rlci9lbnRyaWVzLyR7ZW50cnlJZH0/YWNjZXNzX3Rva2VuPSR7XHJcbiAgICAgIGVudmlyb25tZW50LmNvbnRlbnRmdWwudG9rZW5cclxuICAgIH1gO1xyXG4gIH1cclxuXHJcbiAgZ2V0Q29udGVudGZ1bFVybFBhcmFtZXRlcnMocGFyYW1zOiB7fSk6IHN0cmluZyB7XHJcbiAgICByZXR1cm4gT2JqZWN0LmVudHJpZXMocGFyYW1zKVxyXG4gICAgICAubWFwKChba2V5LCB2YWxdKSA9PiBgJHtrZXl9PSR7dmFsfWApXHJcbiAgICAgIC5qb2luKFwiJlwiKTtcclxuICB9XHJcblxyXG4gIGdldEV2ZW50SXRlbXMoXHJcbiAgICBob3dNYW55OiBudW1iZXIsXHJcbiAgICB0eXBlOiBFdmVudEl0ZW1UeXBlXHJcbiAgKTogT2JzZXJ2YWJsZTxBcnJheTxFdmVudEl0ZW0+PiB7XHJcbiAgICBjb25zdCBxdWVyeSA9IHtcclxuICAgICAgY29udGVudF90eXBlOiBFdmVudENvbnRlbnRUeXBlcy5FVkVOVF9JVEVNLFxyXG4gICAgICBsb2NhbGU6IHRoaXMuc2V0dGluZ3MuZ2V0TG9jYWxlKCksXHJcbiAgICAgIFwiZmllbGRzLnR5cGVcIjogdHlwZSxcclxuICAgICAgb3JkZXI6IFwiZmllbGRzLnN0YXJ0RGF0ZVwiLFxyXG4gICAgICBsaW1pdDogaG93TWFueVxyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4gdGhpcy5odHRwXHJcbiAgICAgIC5nZXQoXHJcbiAgICAgICAgYCR7dGhpcy5DT05URU5URlVMX1VSTF9FTlRSSUVTfSYke3RoaXMuZ2V0Q29udGVudGZ1bFVybFBhcmFtZXRlcnMoXHJcbiAgICAgICAgICBxdWVyeVxyXG4gICAgICAgICl9YCxcclxuICAgICAgICB7IHJlc3BvbnNlVHlwZTogXCJqc29uXCIgfVxyXG4gICAgICApXHJcbiAgICAgIC5waXBlKFxyXG4gICAgICAgIG1hcCgoZW50cmllczogRW50cnlDb2xsZWN0aW9uPGFueT4pID0+IHtcclxuICAgICAgICAgIC8vIGNvbnN0IGFzc2V0czogQXJyYXk8QXNzZXQ+ID0gZW50cmllcy5pbmNsdWRlcy5Bc3NldDtcclxuXHJcbiAgICAgICAgICByZXR1cm4gZW50cmllcy5pdGVtcy5tYXAoKGl0ZW06IEVudHJ5PGFueT4pID0+IHtcclxuICAgICAgICAgICAgLy8gIGNvbnN0IHByb2ZpbGVQaG90bzogQXNzZXQgPSB0aGlzLmdldEFzc2V0QnlJZChhc3NldHMsIGl0ZW0uZmllbGRzLnBob3RvLnN5cy5pZCk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gbmV3IEV2ZW50SXRlbShcclxuICAgICAgICAgICAgICBpdGVtLmZpZWxkcy50aXRsZSxcclxuICAgICAgICAgICAgICBpdGVtLmZpZWxkcy50eXBlLFxyXG4gICAgICAgICAgICAgIGl0ZW0uZmllbGRzLmNhdGVnb3J5LFxyXG4gICAgICAgICAgICAgIGl0ZW0uZmllbGRzLnNob3J0RGVzY3JpcHRpb24sXHJcbiAgICAgICAgICAgICAgaXRlbS5maWVsZHMuZGVzY3JpcHRpb24sXHJcbiAgICAgICAgICAgICAgaXRlbS5maWVsZHMuc3RhcnREYXRlLFxyXG4gICAgICAgICAgICAgIGl0ZW0uZmllbGRzLmVuZERhdGUsXHJcbiAgICAgICAgICAgICAgdW5kZWZpbmVkIC8vIFRPRE86IHphbWllbmnEhyBuYSBwb2JpZXJhbmllIFNwZWFrZXJhXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9KVxyXG4gICAgICApO1xyXG4gIH1cclxuXHJcbiAgZ2V0V29ya3Nob3BzKGhvd01hbnk6IG51bWJlcik6IE9ic2VydmFibGU8QXJyYXk8V29ya3Nob3A+PiB7XHJcbiAgICBjb25zdCBxdWVyeSA9IHtcclxuICAgICAgY29udGVudF90eXBlOiBFdmVudENvbnRlbnRUeXBlcy5XT1JLU0hPUCxcclxuICAgICAgbG9jYWxlOiB0aGlzLnNldHRpbmdzLmdldExvY2FsZSgpLFxyXG4gICAgICBvcmRlcjogXCJzeXMuY3JlYXRlZEF0XCIsXHJcbiAgICAgIGxpbWl0OiBob3dNYW55XHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiB0aGlzLmh0dHBcclxuICAgICAgLmdldChcclxuICAgICAgICBgJHt0aGlzLkNPTlRFTlRGVUxfVVJMX0VOVFJJRVN9JiR7dGhpcy5nZXRDb250ZW50ZnVsVXJsUGFyYW1ldGVycyhcclxuICAgICAgICAgIHF1ZXJ5XHJcbiAgICAgICAgKX1gLFxyXG4gICAgICAgIHsgcmVzcG9uc2VUeXBlOiBcImpzb25cIiB9XHJcbiAgICAgIClcclxuICAgICAgLnBpcGUoXHJcbiAgICAgICAgbWFwKChlbnRyaWVzOiBFbnRyeUNvbGxlY3Rpb248YW55PikgPT4ge1xyXG4gICAgICAgICAgY29uc3QgYXNzZXRzOiBBcnJheTxBc3NldD4gPSBlbnRyaWVzLmluY2x1ZGVzLkFzc2V0O1xyXG4gICAgICAgICAgY29uc3QgbGlua3M6IEFycmF5PEVudHJ5PGFueT4+ID0gZW50cmllcy5pbmNsdWRlcy5FbnRyeTtcclxuXHJcbiAgICAgICAgICByZXR1cm4gZW50cmllcy5pdGVtcy5tYXAoKGl0ZW06IEVudHJ5PGFueT4pID0+IHtcclxuICAgICAgICAgICAgLy8gIGNvbnN0IHByb2ZpbGVQaG90bzogQXNzZXQgPSB0aGlzLmdldEFzc2V0QnlJZChhc3NldHMsIGl0ZW0uZmllbGRzLnBob3RvLnN5cy5pZCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHNwZWFrZXIgPSB0aGlzLmdldEVudHJ5QnlJZChcclxuICAgICAgICAgICAgICBsaW5rcyxcclxuICAgICAgICAgICAgICBpdGVtLmZpZWxkcy5pbnN0cnVjdG9yLnN5cy5pZFxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcIlNwZWthZXI6IFwiLCBzcGVha2VyKTtcclxuICAgICAgICAgICAgY29uc3Qgc3BlYWtlclBob3RvID0gdGhpcy5nZXRBc3NldEJ5SWQoXHJcbiAgICAgICAgICAgICAgYXNzZXRzLFxyXG4gICAgICAgICAgICAgIHNwZWFrZXIuZmllbGRzLnBob3RvLnN5cy5pZFxyXG4gICAgICAgICAgICApO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBXb3Jrc2hvcChcclxuICAgICAgICAgICAgICBpdGVtLmZpZWxkcy50aXRsZSxcclxuICAgICAgICAgICAgICBpdGVtLmZpZWxkcy5kZXNjcmlwdGlvbixcclxuICAgICAgICAgICAgICBuZXcgU3BlYWtlcihcclxuICAgICAgICAgICAgICAgIHNwZWFrZXIuZmllbGRzLm5hbWUsXHJcbiAgICAgICAgICAgICAgICBzcGVha2VyLmZpZWxkcy5yb2xlLFxyXG4gICAgICAgICAgICAgICAgc3BlYWtlci5maWVsZHMuYmlvLFxyXG4gICAgICAgICAgICAgICAgc3BlYWtlclBob3RvID8gc3BlYWtlclBob3RvLmZpZWxkcy5maWxlLnVybCA6IHVuZGVmaW5lZCxcclxuICAgICAgICAgICAgICAgIHNwZWFrZXJQaG90byA/IHNwZWFrZXJQaG90by5maWVsZHMudGl0bGUgOiB1bmRlZmluZWQsXHJcbiAgICAgICAgICAgICAgICBzcGVha2VyUGhvdG8gPyBzcGVha2VyUGhvdG8uZmllbGRzLmRlc2NyaXB0aW9uIDogdW5kZWZpbmVkLFxyXG4gICAgICAgICAgICAgICAgc3BlYWtlci5maWVsZHMuZW1haWwsXHJcbiAgICAgICAgICAgICAgICBzcGVha2VyLmZpZWxkcy51cmxHaXRodWIsXHJcbiAgICAgICAgICAgICAgICBzcGVha2VyLmZpZWxkcy51cmxMaW5rZWRJbixcclxuICAgICAgICAgICAgICAgIHNwZWFrZXIuZmllbGRzLnVybFR3aXR0ZXIsXHJcbiAgICAgICAgICAgICAgICBzcGVha2VyLmZpZWxkcy51cmxXd3dcclxuICAgICAgICAgICAgICApLFxyXG4gICAgICAgICAgICAgIGl0ZW0uZmllbGRzLnN0YXJ0RGF0ZSxcclxuICAgICAgICAgICAgICBpdGVtLmZpZWxkcy5lbmREYXRlLFxyXG4gICAgICAgICAgICAgIDAsIC8vIFRPRE86IHphbWllbmnEhyBuYSB3c3DDs8WCcnrEmWRuZVxyXG4gICAgICAgICAgICAgIDAsIC8vIFRPRE86IHphbWllbmnEhyBuYSB3c3DDs8WCcnrEmWRuZVxyXG4gICAgICAgICAgICAgIGl0ZW0uZmllbGRzLmxvY2F0aW9uRGVzY3JpcHRpb24sXHJcbiAgICAgICAgICAgICAgaXRlbS5maWVsZHMucHJpY2VQbG5cclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICk7XHJcbiAgfVxyXG5cclxuICBnZXRTcGVha2Vycyhob3dNYW55OiBudW1iZXIpOiBPYnNlcnZhYmxlPEFycmF5PFNwZWFrZXI+PiB7XHJcbiAgICBjb25zdCBxdWVyeSA9IHtcclxuICAgICAgY29udGVudF90eXBlOiBFdmVudENvbnRlbnRUeXBlcy5TUEVBS0VSLFxyXG4gICAgICBsb2NhbGU6IHRoaXMuc2V0dGluZ3MuZ2V0TG9jYWxlKCksXHJcbiAgICAgIG9yZGVyOiBcInN5cy5jcmVhdGVkQXRcIixcclxuICAgICAgbGltaXQ6IGhvd01hbnlcclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuaHR0cFxyXG4gICAgICAuZ2V0KFxyXG4gICAgICAgIGAke3RoaXMuQ09OVEVOVEZVTF9VUkxfRU5UUklFU30mJHt0aGlzLmdldENvbnRlbnRmdWxVcmxQYXJhbWV0ZXJzKFxyXG4gICAgICAgICAgcXVlcnlcclxuICAgICAgICApfWAsXHJcbiAgICAgICAgeyByZXNwb25zZVR5cGU6IFwianNvblwiIH1cclxuICAgICAgKVxyXG4gICAgICAucGlwZShcclxuICAgICAgICBtYXAoKGVudHJpZXM6IEVudHJ5Q29sbGVjdGlvbjxhbnk+KSA9PiB7XHJcbiAgICAgICAgICBjb25zdCBhc3NldHM6IEFycmF5PEFzc2V0PiA9IGVudHJpZXMuaW5jbHVkZXMuQXNzZXQ7XHJcblxyXG4gICAgICAgICAgcmV0dXJuIGVudHJpZXMuaXRlbXMubWFwKChpdGVtOiBFbnRyeTxhbnk+KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHByb2ZpbGVQaG90bzogQXNzZXQgPSB0aGlzLmdldEFzc2V0QnlJZChcclxuICAgICAgICAgICAgICBhc3NldHMsXHJcbiAgICAgICAgICAgICAgaXRlbS5maWVsZHMucGhvdG8uc3lzLmlkXHJcbiAgICAgICAgICAgICk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFNwZWFrZXIoXHJcbiAgICAgICAgICAgICAgaXRlbS5maWVsZHMubmFtZSxcclxuICAgICAgICAgICAgICBpdGVtLmZpZWxkcy5yb2xlLFxyXG4gICAgICAgICAgICAgIGl0ZW0uZmllbGRzLmJpbyxcclxuICAgICAgICAgICAgICBwcm9maWxlUGhvdG8gPyBwcm9maWxlUGhvdG8uZmllbGRzLmZpbGUudXJsIDogdW5kZWZpbmVkLFxyXG4gICAgICAgICAgICAgIHByb2ZpbGVQaG90byA/IHByb2ZpbGVQaG90by5maWVsZHMudGl0bGUgOiB1bmRlZmluZWQsXHJcbiAgICAgICAgICAgICAgcHJvZmlsZVBob3RvID8gcHJvZmlsZVBob3RvLmZpZWxkcy5kZXNjcmlwdGlvbiA6IHVuZGVmaW5lZCxcclxuICAgICAgICAgICAgICBpdGVtLmZpZWxkcy5lbWFpbCxcclxuICAgICAgICAgICAgICBpdGVtLmZpZWxkcy51cmxHaXRodWIsXHJcbiAgICAgICAgICAgICAgaXRlbS5maWVsZHMudXJsTGlua2VkSW4sXHJcbiAgICAgICAgICAgICAgaXRlbS5maWVsZHMudXJsVHdpdHRlcixcclxuICAgICAgICAgICAgICBpdGVtLmZpZWxkcy51cmxXd3dcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldEFzc2V0QnlJZChhc3NldEFycmF5OiBBcnJheTxBc3NldD4sIGlkOiBzdHJpbmcpOiBhbnkge1xyXG4gICAgaWYgKGFzc2V0QXJyYXkgJiYgYXNzZXRBcnJheS5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGNvbnN0IG5ld0FycmF5ID0gYXNzZXRBcnJheS5maWx0ZXIoKGl0ZW06IEFzc2V0KSA9PiBpdGVtLnN5cy5pZCA9PT0gaWQpO1xyXG4gICAgICBpZiAobmV3QXJyYXkgJiYgbmV3QXJyYXkubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIHJldHVybiBuZXdBcnJheVswXTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7fTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0QXNzZXRzQnlJZHMoYXNzZXRBcnJheTogQXJyYXk8QXNzZXQ+LCBpZHM6IEFycmF5PHN0cmluZz4pOiBhbnkge1xyXG4gICAgaWYgKGFzc2V0QXJyYXkgJiYgYXNzZXRBcnJheS5sZW5ndGggPiAwICYmIGlkcyAmJiBpZHMubGVuZ3RoID4gMCkge1xyXG4gICAgICBjb25zdCBuZXdBcnJheSA9IGFzc2V0QXJyYXkuZmlsdGVyKChpdGVtOiBBc3NldCkgPT4ge1xyXG4gICAgICAgIHJldHVybiBpZHMuaW5jbHVkZXMoaXRlbS5zeXMuaWQpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHJldHVybiBuZXdBcnJheTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge307XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldEVudHJ5QnlJZChlbnRyaWVzQXJyYXk6IEFycmF5PEVudHJ5PGFueT4+LCBpZDogc3RyaW5nKTogYW55IHtcclxuICAgIGlmIChlbnRyaWVzQXJyYXkgJiYgZW50cmllc0FycmF5Lmxlbmd0aCA+IDApIHtcclxuICAgICAgY29uc3QgbmV3QXJyYXkgPSBlbnRyaWVzQXJyYXkuZmlsdGVyKFxyXG4gICAgICAgIChpdGVtOiBFbnRyeTxhbnk+KSA9PiBpdGVtLnN5cy5pZCA9PT0gaWRcclxuICAgICAgKTtcclxuICAgICAgaWYgKG5ld0FycmF5ICYmIG5ld0FycmF5Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICByZXR1cm4gbmV3QXJyYXlbMF07XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge307XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldEVudHJpZXNCeUNvbnRlbnRUeXBlKFxyXG4gICAgZW50cmllc0FycmF5OiBBcnJheTxFbnRyeTxhbnk+PixcclxuICAgIGNvbnRlbnRUeXBlOiBFdmVudENvbnRlbnRUeXBlc1xyXG4gICk6IGFueSB7XHJcbiAgICBpZiAoZW50cmllc0FycmF5ICYmIGVudHJpZXNBcnJheS5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGNvbnN0IG5ld0FycmF5ID0gZW50cmllc0FycmF5LmZpbHRlcihcclxuICAgICAgICAoaXRlbTogRW50cnk8YW55PikgPT4gaXRlbS5zeXMuY29udGVudFR5cGUuc3lzLmlkID09PSBjb250ZW50VHlwZVxyXG4gICAgICApO1xyXG4gICAgICBpZiAobmV3QXJyYXkgJiYgbmV3QXJyYXkubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIHJldHVybiBuZXdBcnJheTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7fTtcclxuICB9XHJcbn1cclxuIl19